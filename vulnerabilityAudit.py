from nvdlib import *
from dominate.tags import *

from variables import d_vulnerability,device_type,cve_list
from DigInv import version


def vuln(l):

    _s=['version','score','severity']
    i=0
    d=div(_class='square')
    with d:
        for elt in l:
            d+=div(_s[i],':','%s'%elt)
            i+=1
            
    return d


#verify the nature of the device (router,switch,firewall) and the version of its OS.
if (device_type=='router'):
    _keyword="cisco ios "+version+" router"
    
elif(device_type=='switch'):
    _keyword="cisco ios "+version+" switch"
else:
    _keyword="cisco asa "+version


r = searchCVE(keyword = _keyword, key='92db6ce5-1190-4ce3-a1aa-d8de6b33e87c')
i=1
for rr in r:
    
    cve_list.append(rr.id)

    inf_div=div(_class="information")
    threat_div=div(_class="container")

    with inf_div:
        inf_div += h3('%d. %s' % (i,rr.id))
        inf_div+=h5("Description")
        inf_div += p('%s' %rr.cve.description.description_data[0].value)
        inf_div+=h5("For more details about this CVE, click this link below:")
        inf_div+=a(rr.url,href=rr.url)
        _list=list()
        _list.append(rr.score[0])
        _list.append(rr.score[1])
        _list.append(rr.score[2])
        
        i=i+1
    
    square_div=vuln(_list)
    threat_div+=inf_div
    threat_div+=square_div
    d_vulnerability+=threat_div
    
    
    
        
